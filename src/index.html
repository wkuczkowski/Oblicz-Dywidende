<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Kalkulator dywidendy - oblicz dywidendę na udział dla każdego wspólnika w spółce" />
    <meta
      name="keywords"
      content="kalkulator dywidendy, dywidenda, udziały, wspólnicy, spółka" />
    <link href="./output.css" rel="stylesheet" />
    <title>Kalkulator Dywidendy - Oblicz dywidendę na udział</title>
  </head>
  <body>
    <a href="#main-content"> Przejdź do głównej treści </a>

    <div>
      <header>
        <h1>Kalkulator Dywidendy</h1>
        <p>
          Profesjonalne narzędzie do obliczania dywidendy na udział dla każdego
          wspólnika w spółce
        </p>
      </header>

      <main id="main-content">
        <section aria-labelledby="config-heading">
          <div>
            <div>
              <h2 id="config-heading">Konfiguracja kalkulatora</h2>
            </div>

            <div>
              <div>
                <label for="privilegedBonus">
                  Bonus udziałów uprzywilejowanych (%)
                </label>
                <div>
                  <input
                    type="number"
                    id="privilegedBonus"
                    placeholder="25"
                    value="25"
                    min="0"
                    step="0.1"
                    aria-describedby="privilegedBonus-help" />
                  <span aria-hidden="true">%</span>
                </div>
                <p id="privilegedBonus-help">
                  Każdy udział uprzywilejowany = 1 + (bonus/100) udziału
                  nieuprzywilejowanego
                </p>
              </div>

              <div>
                <label for="totalDividend">
                  Kwota dywidendy do wypłaty (PLN)
                </label>
                <div>
                  <input
                    type="text"
                    id="totalDividend"
                    placeholder="100 000,00"
                    value="100 000,00"
                    aria-describedby="totalDividend-help" />
                  <span aria-hidden="true">zł</span>
                </div>
                <p id="totalDividend-help">
                  Całkowita kwota dywidendy do rozdzielenia między wspólników
                </p>
              </div>
            </div>
          </div>
        </section>

        <section aria-labelledby="partners-heading">
          <div>
            <div>
              <div>
                <h2 id="partners-heading">Wspólnicy</h2>
              </div>
              <button id="addPartner" aria-label="Dodaj nowego wspólnika">
                Dodaj wspólnika
              </button>
            </div>

            <div
              id="partnersContainer"
              role="group"
              aria-labelledby="partners-heading">
              <!-- Partners will be added here dynamically -->
            </div>
          </div>
        </section>

        <section aria-labelledby="results-heading">
          <div>
            <div>
              <div>
                <h2 id="results-heading">Wyniki obliczeń</h2>
              </div>
              <button id="copyResults" aria-label="Kopiuj wyniki do schowka">
                Kopiuj wyniki
              </button>
            </div>

            <div>
              <div>
                <div>Razem efektywnych udziałów</div>
                <div id="totalEffectiveShares" aria-live="polite">0</div>
              </div>

              <div>
                <div>Dywidenda na udział uprzywilejowany</div>
                <div id="dividendPerPrivileged" aria-live="polite">0,00 zł</div>
              </div>

              <div>
                <div>Dywidenda na udział nieuprzywilejowany</div>
                <div id="dividendPerRegular" aria-live="polite">0,00 zł</div>
              </div>

              <div>
                <div>Łączna liczba wspólników</div>
                <div id="totalPartners" aria-live="polite">0</div>
              </div>
            </div>

            <div>
              <h3>Wypłaty dla wspólników</h3>
              <div
                id="partnersResults"
                role="region"
                aria-label="Wyniki wypłat dla wspólników"
                aria-live="polite">
                <!-- Results will be displayed here -->
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <script>
      let partnerCount = 0;
      let partners = [];

      // Initialize app
      document.addEventListener("DOMContentLoaded", function () {
        addPartner();
        calculate();
        setupInputAutoSelect();
        setupCopyResults();
        setupInputFormatting();
      });

      // Event listeners
      document
        .getElementById("addPartner")
        .addEventListener("click", addPartner);
      document
        .getElementById("privilegedBonus")
        .addEventListener("input", calculate);
      document
        .getElementById("totalDividend")
        .addEventListener("input", calculate);

      // Utility functions for Polish currency formatting
      function formatPolishCurrency(amount) {
        return (
          amount.toLocaleString("pl-PL", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          }) + " zł"
        );
      }

      function formatPolishNumber(number) {
        return number.toLocaleString("pl-PL", {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        });
      }

      function formatPolishInteger(number) {
        return number.toLocaleString("pl-PL", {
          minimumFractionDigits: 0,
          maximumFractionDigits: 0,
        });
      }

      function parsePolishNumber(formattedValue) {
        return (
          parseFloat(formattedValue.replace(/\s/g, "").replace(",", ".")) || 0
        );
      }

      function formatInputValue(input, value) {
        const numValue = parseFloat(value) || 0;
        input.value = formatPolishNumber(numValue);
      }

      // Input enhancements
      function setupInputAutoSelect() {
        document
          .querySelectorAll('input[type="number"], input[type="text"]')
          .forEach((input) => {
            input.addEventListener("focus", function () {
              this.select();
            });
          });
      }

      function setupInputFormatting() {
        const totalDividendInput = document.getElementById("totalDividend");

        totalDividendInput.addEventListener("blur", function () {
          const value = parsePolishNumber(this.value);
          if (value > 0) {
            formatInputValue(this, value);
          }
        });

        totalDividendInput.addEventListener("focus", function () {
          const value = parsePolishNumber(this.value);
          if (value > 0) {
            this.value = value.toString();
          }
        });
      }

      function setupCopyResults() {
        document
          .getElementById("copyResults")
          .addEventListener("click", copyResultsToClipboard);
      }

      function addAutoSelectToInput(input) {
        input.addEventListener("focus", function () {
          this.select();
        });
      }

      // Partner management
      function addPartner() {
        partnerCount++;
        const partnerId = `partner_${partnerCount}`;

        const partnerDiv = document.createElement("div");
        partnerDiv.id = partnerId;
        partnerDiv.setAttribute("role", "group");
        partnerDiv.setAttribute("aria-label", `Wspólnik ${partnerCount}`);

        partnerDiv.innerHTML = `
        <div>
          <h3>Wspólnik ${partnerCount}</h3>
          ${
            partnerCount > 1
              ? `
            <button 
              onclick="removePartner('${partnerId}')"
              aria-label="Usuń wspólnika ${partnerCount}"
            >
              Usuń
            </button>
          `
              : ""
          }
        </div>
        
        <div>
          <div>
            <label for="${partnerId}_name">
              Nazwa wspólnika
            </label>
            <input 
              type="text" 
              id="${partnerId}_name"
              placeholder="Jan Kowalski" 
              onchange="updatePartnerName('${partnerId}', this.value)"
              aria-required="true"
            >
          </div>
          
          <div>
            <label for="${partnerId}_privileged">
              Udziały uprzywilejowane
            </label>
            <input 
              type="number" 
              id="${partnerId}_privileged"
              class="privileged-shares" 
              placeholder="0" 
              value="0" 
              min="0" 
              step="1"
              onchange="calculate()"
              aria-describedby="${partnerId}_privileged_help"
            >
            <p id="${partnerId}_privileged_help">
              Liczba udziałów uprzywilejowanych dla tego wspólnika
            </p>
          </div>
          
          <div>
            <label for="${partnerId}_regular">
              Udziały nieuprzywilejowane
            </label>
            <input 
              type="number" 
              id="${partnerId}_regular"
              class="regular-shares" 
              placeholder="0" 
              value="0" 
              min="0" 
              step="1"
              onchange="calculate()"
              aria-describedby="${partnerId}_regular_help"
            >
            <p id="${partnerId}_regular_help">
              Liczba udziałów nieuprzywilejowanych dla tego wspólnika
            </p>
          </div>
        </div>
      `;

        document.getElementById("partnersContainer").appendChild(partnerDiv);

        // Add auto-select to new inputs
        partnerDiv.querySelectorAll("input").forEach(addAutoSelectToInput);

        partners.push({
          id: partnerId,
          name: `Wspólnik ${partnerCount}`,
          privilegedShares: 0,
          regularShares: 0,
        });

        // Focus on name input for new partner
        document.getElementById(`${partnerId}_name`).focus();

        calculate();
      }

      function removePartner(partnerId) {
        const partnerElement = document.getElementById(partnerId);
        if (partnerElement) {
          partnerElement.remove();
          partners = partners.filter((p) => p.id !== partnerId);
          calculate();

          // Announce removal for screen readers
          const announcement = document.createElement("div");
          announcement.setAttribute("aria-live", "polite");
          announcement.textContent = "Wspólnik został usunięty";
          document.body.appendChild(announcement);
          setTimeout(() => document.body.removeChild(announcement), 1000);
        }
      }

      function updatePartnerName(partnerId, name) {
        const partner = partners.find((p) => p.id === partnerId);
        if (partner) {
          partner.name = name || `Wspólnik ${partnerId.split("_")[1]}`;
        }
        calculate();
      }

      // Copy results functionality
      function copyResultsToClipboard() {
        const privilegedBonus =
          parseFloat(document.getElementById("privilegedBonus").value) || 0;
        const totalDividend = parsePolishNumber(
          document.getElementById("totalDividend").value
        );

        const privilegedMultiplier = 1 + privilegedBonus / 100;
        let totalEffectiveShares = 0;

        partners.forEach((partner) => {
          partner.effectiveShares =
            partner.privilegedShares * privilegedMultiplier +
            partner.regularShares;
          totalEffectiveShares += partner.effectiveShares;
        });

        const dividendPerEffectiveShare =
          totalEffectiveShares > 0 ? totalDividend / totalEffectiveShares : 0;
        const dividendPerPrivileged =
          dividendPerEffectiveShare * privilegedMultiplier;
        const dividendPerRegular = dividendPerEffectiveShare;

        let resultsText = `WYNIKI KALKULACJI DYWIDENDY\n`;
        resultsText += `================================\n\n`;
        resultsText += `KONFIGURACJA:\n`;
        resultsText += `• Bonus udziałów uprzywilejowanych: ${privilegedBonus}%\n`;
        resultsText += `• Kwota dywidendy do wypłaty: ${formatPolishCurrency(
          totalDividend
        )}\n\n`;
        resultsText += `PODSUMOWANIE:\n`;
        resultsText += `• Razem efektywnych udziałów: ${formatPolishInteger(
          totalEffectiveShares
        )}\n`;
        resultsText += `• Dywidenda na udział uprzywilejowany: ${formatPolishCurrency(
          dividendPerPrivileged
        )}\n`;
        resultsText += `• Dywidenda na udział nieuprzywilejowany: ${formatPolishCurrency(
          dividendPerRegular
        )}\n`;
        resultsText += `• Łączna liczba wspólników: ${partners.length}\n\n`;
        resultsText += `WYPŁATY DLA WSPÓLNIKÓW:\n`;
        resultsText += `================================\n`;

        partners.forEach((partner, index) => {
          const privilegedPayout =
            partner.privilegedShares * dividendPerPrivileged;
          const regularPayout = partner.regularShares * dividendPerRegular;
          const totalPayout = privilegedPayout + regularPayout;

          resultsText += `\n${index + 1}. ${partner.name}\n`;
          resultsText += `   • Udziały uprzywilejowane: ${
            partner.privilegedShares
          } × ${formatPolishCurrency(
            dividendPerPrivileged
          )} = ${formatPolishCurrency(privilegedPayout)}\n`;
          resultsText += `   • Udziały nieuprzywilejowane: ${
            partner.regularShares
          } × ${formatPolishCurrency(
            dividendPerRegular
          )} = ${formatPolishCurrency(regularPayout)}\n`;
          resultsText += `   • Efektywne udziały: ${formatPolishInteger(
            partner.effectiveShares
          )}\n`;
          resultsText += `   • ŁĄCZNA WYPŁATA: ${formatPolishCurrency(
            totalPayout
          )}\n`;
        });

        resultsText += `\n================================\n`;
        resultsText += `Wygenerowano: ${new Date().toLocaleString("pl-PL")}\n`;

        navigator.clipboard
          .writeText(resultsText)
          .then(() => {
            showCopySuccess();
          })
          .catch((err) => {
            console.error("Błąd kopiowania:", err);
            alert("Nie udało się skopiować wyników do schowka.");
          });
      }

      function showCopySuccess() {
        const button = document.getElementById("copyResults");
        const originalText = button.innerHTML;

        button.innerHTML = "Skopiowano!";

        setTimeout(() => {
          button.innerHTML = originalText;
        }, 2000);
      }

      // Main calculation function
      function calculate() {
        const privilegedBonus =
          parseFloat(document.getElementById("privilegedBonus").value) || 0;
        const totalDividendInput = document.getElementById("totalDividend");
        const totalDividend = parsePolishNumber(totalDividendInput.value);

        // Update partners data
        partners.forEach((partner) => {
          const partnerDiv = document.getElementById(partner.id);
          if (partnerDiv) {
            const privilegedInput =
              partnerDiv.querySelector(".privileged-shares");
            const regularInput = partnerDiv.querySelector(".regular-shares");

            partner.privilegedShares = parseInt(privilegedInput.value) || 0;
            partner.regularShares = parseInt(regularInput.value) || 0;
          }
        });

        // Calculate effective shares
        const privilegedMultiplier = 1 + privilegedBonus / 100;
        let totalEffectiveShares = 0;

        partners.forEach((partner) => {
          partner.effectiveShares =
            partner.privilegedShares * privilegedMultiplier +
            partner.regularShares;
          totalEffectiveShares += partner.effectiveShares;
        });

        // Calculate dividends per share
        const dividendPerEffectiveShare =
          totalEffectiveShares > 0 ? totalDividend / totalEffectiveShares : 0;
        const dividendPerPrivileged =
          dividendPerEffectiveShare * privilegedMultiplier;
        const dividendPerRegular = dividendPerEffectiveShare;

        // Update summary results
        document.getElementById("totalEffectiveShares").textContent =
          formatPolishInteger(totalEffectiveShares);
        document.getElementById("dividendPerPrivileged").textContent =
          formatPolishCurrency(dividendPerPrivileged);
        document.getElementById("dividendPerRegular").textContent =
          formatPolishCurrency(dividendPerRegular);
        document.getElementById("totalPartners").textContent = partners.length;

        // Generate partner results
        const resultsContainer = document.getElementById("partnersResults");
        resultsContainer.innerHTML = "";

        if (partners.length === 0) {
          resultsContainer.innerHTML = `
          <div>
            <p>Brak wspólników do wyświetlenia</p>
            <p>Dodaj wspólników aby zobaczyć wyniki obliczeń</p>
          </div>
        `;
          return;
        }

        partners.forEach((partner) => {
          const privilegedPayout =
            partner.privilegedShares * dividendPerPrivileged;
          const regularPayout = partner.regularShares * dividendPerRegular;
          const totalPayout = privilegedPayout + regularPayout;

          const resultDiv = document.createElement("div");
          resultDiv.innerHTML = `
          <div>
            <h4>${partner.name}</h4>
            <div>${formatPolishCurrency(totalPayout)}</div>
          </div>
          <div>
            <div>
              <div>Uprzywilejowane</div>
              <div>${partner.privilegedShares} × ${formatPolishCurrency(
            dividendPerPrivileged
          )}</div>
              <div>${formatPolishCurrency(privilegedPayout)}</div>
            </div>
            <div>
              <div>Nieuprzywilejowane</div>
              <div>${partner.regularShares} × ${formatPolishCurrency(
            dividendPerRegular
          )}</div>
              <div>${formatPolishCurrency(regularPayout)}</div>
            </div>
            <div>
              <div>Efektywne udziały</div>
              <div>${formatPolishInteger(partner.effectiveShares)}</div>
            </div>
          </div>
        `;
          resultsContainer.appendChild(resultDiv);
        });
      }
    </script>
  </body>
</html>
